<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Adam Asmaca - Çift Kişilik</title>
<style>
  :root{
    --bg:#0f1724; --card:#0b1220; --accent:#06b6d4; --muted:#9ca3af;
    --win:#10b981; --lose:#ef4444;
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
    font-family:Inter, system-ui, Arial; background:linear-gradient(180deg,#031028 0%,#071427 100%);
    color:#e6eef6; padding:24px;
  }
  .wrap{
    width:100%; max-width:980px; background:rgba(255,255,255,0.02);
    border-radius:12px; padding:20px; box-shadow:0 8px 30px rgba(2,6,23,0.6);
    display:grid; grid-template-columns: 1fr 300px; gap:18px;
  }
  header{grid-column:1 / -1; display:flex; align-items:center; justify-content:space-between;}
  h1{margin:0; font-size:20px;}
  .controls{display:flex; gap:8px; align-items:center;}
  button {background:var(--accent); border:none; padding:8px 12px; border-radius:8px; color:#042027; font-weight:700; cursor:pointer;}
  button.ghost{background:transparent; border:1px solid rgba(255,255,255,0.1); color:var(--muted);}
  .left{padding:12px;}
  .canvas-wrap{background:rgba(0,0,0,0.25); border-radius:10px; padding:12px; display:flex; align-items:center; justify-content:center;}
  canvas{background:transparent; width:100%; height:300px;}
  .word{display:flex; gap:10px; margin:18px 0; flex-wrap:wrap;}
  .letter{min-width:34px; height:44px; border-bottom:3px solid rgba(255,255,255,0.06); display:flex; align-items:center; justify-content:center; font-size:22px; font-weight:700;}
  .info{display:flex; gap:10px; align-items:center; color:var(--muted); font-size:14px;}
  .keyboard{display:grid; grid-template-columns:repeat(10,1fr); gap:8px; margin-top:12px;}
  .key{padding:10px 8px; background:rgba(255,255,255,0.05); border-radius:8px; text-align:center; cursor:pointer; user-select:none;}
  .key.disabled{opacity:0.3; pointer-events:none;}
  .sidebar{padding:12px; background:rgba(255,255,255,0.02); border-radius:10px;}
  .stats{margin-bottom:20px;}
  .stat{display:flex; justify-content:space-between; color:var(--muted); padding:6px 0;}

  /* POPUP GENEL */
  .popup-bg{
    position:fixed; inset:0; background:rgba(0,0,0,0.6);
    display:none; align-items:center; justify-content:center;
  }
  .popup{
    background:#111827; padding:24px; border-radius:12px;
    width:320px; text-align:center; box-shadow:0 0 20px rgba(0,0,0,0.4);
  }
  .popup h2{margin:0 0 8px;}
  .popup button{margin-top:14px; width:100%;}
</style>
</head>
<body>

<!-- KELİME GİRİŞ POPUP -->
<div class="popup-bg" id="wordPopupBg">
  <div class="popup">
    <h2 id = "wordPopupTitle">Kelimeyi Girin</h2>
    <input id="wordInput" type="password"
      placeholder="Kelime..."
      style="width:100%; padding:10px; border-radius:8px; border:none; background:#0f1724; color:white; margin-top:10px; font-size:16px;">
    <button id="wordSubmitBtn">Başlat</button>
  </div>
</div>

<!-- SONUÇ POPUP -->
<div class="popup-bg" id="popupBg">
  <div class="popup" id="popupBox">
    <h2 id="popupTitle">Sonuç</h2>
    <p id="popupWord"></p>
    <p id="popupStats"></p>
    <button id="popupBtn">Devam</button>
  </div>
</div>
<!-- SIRA BİLDİRİM POPUP -->
<div class="popup-bg" id="turnPopupBg">
  <div class="popup">
    <h2 id="turnTitle">Sıra</h2>
    <button id="turnBtn">Başla</button>
  </div>
</div>
<!-- SIRA BİLDİRİM POPUP -->
<div class="popup-bg" id="turnPopupBg">
  <div class="popup">
    <h2 id="turnTitle">Sıra</h2>
    <button id="turnBtn">Başla</button>
  </div>
</div>

<div class="wrap">
  <header>
    <h1>Adam Asmaca - Çift Kişilik</h1>
    <div class="controls">
      <button id="newGameBtn">Kelimeyi tekrar gir</button>
      <button onclick="goMenu()" class="buton C">Ana Menü</button>
    </div>
  </header>

  <section class="left">
    <div class="canvas-wrap">
      <canvas id="hangCanvas" width="480" height="320"></canvas>
    </div>

    <div class="info">
      <div>Kalan hak: <strong id="lives">6</strong></div>
      <div>Kelime uzunluğu: <strong id="len">—</strong></div>
    </div>

    <div class="word" id="wordContainer"></div>
    <div class="keyboard" id="keyboard"></div>
  </section>

  <aside class="sidebar">
    <h3>Skor Tablosu</h3>
    <div class="stats">
      <div class="stat"><span>1. Oyuncu</span><span id="wins1">0</span></div>
      <div class="stat"><span>2. Oyuncu</span><span id="wins2">0</span></div>
    </div>
  </aside>
</div>

<script>
let state = {
  word: "",
  revealed: [],
  lives: 7,
  guesses: new Set(),
  wins1: 0,
  wins2: 0,
  activeGuesser: 2
};

let drawStep = 0;

const canvas = document.getElementById("hangCanvas");
const ctx = canvas.getContext("2d");
const popupBg = document.getElementById("popupBg");
const popupTitle = document.getElementById("popupTitle");
const popupWord = document.getElementById("popupWord");
const popupStats = document.getElementById("popupStats");
const popupBtn = document.getElementById("popupBtn");
const wins1El = document.getElementById("wins1");
const wins2El = document.getElementById("wins2");
const keyboardEl = document.getElementById("keyboard");
const lenEl = document.getElementById("len");
const livesEl = document.getElementById("lives");

/* ------------------ Yeni Oyun / Kelime Giriş Popup ------------------ */
function askWord(){
  const activeSetter = state.activeGuesser === 1 ? 2 : 1;

  document.getElementById("wordPopupBg").style.display = "flex";
  document.getElementById("wordInput").value = "";
  document.getElementById("wordInput").focus();
  document.getElementById("wordPopupTitle").textContent =
  `${activeSetter}. Oyuncu kelimeyi girin`;

  document.getElementById("wordSubmitBtn").onclick = () => {
    let word = document.getElementById("wordInput").value.toLowerCase().trim();
    if(!word){
      alert("Kelime boş olamaz!");
      return;
    }

    document.getElementById("wordPopupBg").style.display = "none";

    state.word = word;
    state.revealed = Array.from(word).map(_ => "_");
    state.lives = 7;
    state.guesses = new Set();
    drawStep = 0;

    clearCanvas();
    drawGallow();
    updateUI();

    /* BURASI YENİ: sıra bildirimi popup aç */
    showTurnPopup();
  };
}

function showTurnPopup(){
  const guesser = state.activeGuesser;
  document.getElementById("turnTitle").textContent =
    `Sıra ${guesser}. Oyuncuda – Tahmin et!`;
  document.getElementById("turnPopupBg").style.display = "flex";
}

document.getElementById("turnBtn").onclick = () => {
  document.getElementById("turnPopupBg").style.display = "none";
};

/* ------------------ Klavye ------------------ */
const letters = "ABCÇDEFGĞHIJKLMNOÖPRSŞTUÜVYZ".split("");
function renderKeyboard(){
  keyboardEl.innerHTML = "";
  letters.forEach(l=>{
    const key = document.createElement("div");
    key.className="key";
    if(state.guesses.has(l.toLowerCase())) key.classList.add("disabled");
    key.textContent = l;
    key.onclick = () => handleGuess(l.toLowerCase());
    keyboardEl.appendChild(key);
  });
}

/* ------------------ Tahmin ------------------ */
function handleGuess(letter){
  if(state.guesses.has(letter) || isFinished()) return;
  state.guesses.add(letter);

  const guesser = state.activeGuesser;
  const setter = guesser === 1 ? 2 : 1;

  if(state.word.includes(letter)){
    for(let i=0;i<state.word.length;i++)
      if(state.word[i] === letter) state.revealed[i] = letter;

    if(state.revealed.join("") === state.word){
      state[`wins${guesser}`]++;
      updateUI();
      openPopup("win", guesser);
      return;
    }
  } else {
    state.lives--;
    drawNextPart();
    if(state.lives <=0){
      for(let i=0;i<state.word.length;i++)
        if(state.revealed[i]==="_") state.revealed[i]=state.word[i];
      state[`wins${setter}`]++;
      updateUI();
      openPopup("lose", guesser);
      return;
    }
  }
  updateUI();
}

function isFinished(){ return state.revealed.join("")===state.word || state.lives<=0; }

/* ------------------ UI ------------------ */
function updateUI(){
  livesEl.textContent = state.lives;
  lenEl.textContent = state.word.length;

  const w = document.getElementById("wordContainer");
  w.innerHTML = "";
  state.revealed.forEach(ch=>{
    const div = document.createElement("div");
    div.className="letter";
    div.textContent = ch==="_"?"":ch;
    w.appendChild(div);
  });

  renderKeyboard();
  wins1El.textContent = state.wins1;
  wins2El.textContent = state.wins2;
}

/* ------------------ Canvas ------------------ */
function clearCanvas(){ ctx.clearRect(0,0,480,320); ctx.lineWidth=4; ctx.strokeStyle="#cbd5e1"; }
function drawLine(a,b,c,d){ ctx.beginPath(); ctx.moveTo(a,b); ctx.lineTo(c,d); ctx.stroke(); }
function drawCircle(a,b,r){ ctx.beginPath(); ctx.arc(a,b,r,0,Math.PI*2); ctx.stroke(); }
function drawGallow(){
  drawLine(50,300,200,300);
  drawLine(100,300,100,50);
  drawLine(100,50,260,50);
  drawLine(260,50,260,90);
}
function drawNextPart(){
  drawStep++;
  switch(drawStep){
    case 1: drawCircle(260,120,30); break;
    case 2:
      ctx.beginPath();
      ctx.fillStyle="#cbd5e1";
      ctx.arc(250,115,4,0,Math.PI*2); ctx.fill();
      ctx.arc(270,115,4,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.moveTo(250,135); ctx.lineTo(270,135); ctx.stroke(); break;
    case 3: drawLine(260,150,260,220); break;
    case 4: drawLine(260,160,220,190); break;
    case 5: drawLine(260,160,300,190); break;
    case 6: drawLine(260,220,230,270); break;
    case 7: drawLine(260,220,290,270); break;
  }
}

/* ------------------ Sonuç Popup ------------------ */
function openPopup(type, guesser){
  const setter = guesser === 1 ? 2 : 1;

  if(type==="win"){
    popupTitle.textContent = `${guesser}. Oyuncu Kazandı!`;
  } else {
    popupTitle.textContent = `${setter}. Oyuncu Kazandı!`;
  }

  popupWord.textContent = "Kelime: " + state.word.toUpperCase();
  popupStats.textContent = `1. Oyuncu: ${state.wins1} | 2. Oyuncu: ${state.wins2}`;
  popupBg.style.display="flex";

  state.activeGuesser = guesser === 1 ? 2 : 1;
}

function closePopup(){ popupBg.style.display="none"; }
popupBtn.addEventListener("click", ()=>{
  closePopup();
  askWord();
});

/* ------------------ Event Listeners ------------------ */
document.getElementById("newGameBtn").addEventListener("click", askWord);

/* ------------------ Başlangıç ------------------ */
window.onload = askWord;
    function goMenu() {
    window.location.href = "../../index.html"; 
}
</script>

</body>
</html>
